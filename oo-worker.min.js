(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.oo = f()}})(function(){var define,module,exports;return (function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
"use strict";function lowerBound(e,t,s){let u=0,i=e.length;for(;i>0;){const r=i/2|0;let n=u+r;s(e[n],t)<=0?(u=++n,i-=r+1):i=r}return u}class PriorityQueue{constructor(){this._queue=[]}enqueue(e,t){const s={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(s);const u=lowerBound(this._queue,s,(e,t)=>t.priority-e.priority);this._queue.splice(u,0,s)}dequeue(){return this._queue.shift().run}get size(){return this._queue.length}}class PQueue{constructor(e){if(!("number"==typeof(e=Object.assign({concurrency:1/0,autoStart:!0,queueClass:PriorityQueue},e)).concurrency&&e.concurrency>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e.concurrency}\` (${typeof e.concurrency})`);this.queue=new e.queueClass,this._queueClass=e.queueClass,this._pendingCount=0,this._concurrency=e.concurrency,this._isPaused=!1===e.autoStart,this._resolveEmpty=(()=>{}),this._resolveIdle=(()=>{})}_next(){this._pendingCount--,!this._isPaused&&this.queue.size>0?this.queue.dequeue()():(this._resolveEmpty(),this._resolveEmpty=(()=>{}),0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=(()=>{})))}add(e,t){return new Promise((s,u)=>{const i=()=>{this._pendingCount++,e().then(e=>{s(e),this._next()},e=>{u(e),this._next()})};!this._isPaused&&this._pendingCount<this._concurrency?i():this.queue.enqueue(i,t)})}addAll(e,t){return Promise.all(e.map(e=>this.add(e,t)))}start(){if(this._isPaused)for(this._isPaused=!1;this.queue.size>0&&this._pendingCount<this._concurrency;)this.queue.dequeue()()}pause(){this._isPaused=!0}clear(){this.queue=new this._queueClass}onEmpty(){return 0===this.queue.size?Promise.resolve():new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=(()=>{t(),e()})})}onIdle(){return 0===this._pendingCount?Promise.resolve():new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=(()=>{t(),e()})})}get size(){return this.queue.size}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}}module.exports=PQueue;

},{}],2:[function(require,module,exports){
"use strict";function TinyQueue(t,e){if(!(this instanceof TinyQueue))return new TinyQueue(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||defaultCompare,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function defaultCompare(t,e){return t<e?-1:t>e?1:0}module.exports=TinyQueue,module.exports.default=TinyQueue,TinyQueue.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,h=e[t];t>0;){var n=t-1>>1,a=e[n];if(i(h,a)>=0)break;e[t]=a,t=n}e[t]=h},_down:function(t){for(var e=this.data,i=this.compare,h=this.length>>1,n=e[t];t<h;){var a=1+(t<<1),s=a+1,u=e[a];if(s<this.length&&i(e[s],u)<0&&(a=s,u=e[s]),i(u,n)>=0)break;e[t]=u,t=a}e[t]=n}};

},{}],3:[function(require,module,exports){
"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var WorkerState,tinyqueue_1=__importDefault(require("tinyqueue")),p_queue_1=__importDefault(require("p-queue")),Worker=function(){function t(t,e){void 0===t&&(t="default"),void 0===e&&(e={}),this._name=t,this._state=WorkerState.READY,this._options=e,this._initTaskPriorityQueue(),this._initTaskProcessQueue()}return t.prototype._initTaskPriorityQueue=function(){this._tasks=new tinyqueue_1.default},t.prototype._initTaskProcessQueue=function(){this._queue=new p_queue_1.default({concurrency:this._options.concurrency||1,autoStart:!1})},t.prototype.enqueueTask=function(t){this._tasks.push(t)},t.prototype.dequeueTasks=function(t){void 0===t&&(t=1);for(var e=[];t>0&&this._tasks.length>0;)e.push(this._tasks.pop()),t-=1;return e},t.prototype.prepareBatch=function(t){void 0===t&&(t=10);for(var e=0,r=this.dequeueTasks(t);e<r.length;e++){r[e];this._queue.add(function(){return Promise.resolve()})}return this._queue},t.prototype.processBatch=function(){var t=this;return this._state=WorkerState.RUNNING,this._queue.start(),this._queue.onIdle().then(function(){t._state=WorkerState.SUCCEEDED}).catch(function(){t._state=WorkerState.FAILED}),this._queue.onEmpty()},t.prototype._log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console.log.apply(console,["["+this.constructor.name+"]"].concat(t))},t}();function _require(t,e){if(!t){if(e)throw e();throw"illegal argument"}}function _requireNotNil(t,e){if(_isNil(t)){if(e)throw e();throw"illegal argument"}}function _isNil(t){return null===t||void 0===t}exports.Worker=Worker,function(t){t[t.READY=0]="READY",t[t.RUNNING=1]="RUNNING",t[t.SUCCEEDED=2]="SUCCEEDED",t[t.FAILED=3]="FAILED",t[t.CANCELLED=4]="CANCELLED"}(WorkerState||(WorkerState={}));

},{"p-queue":1,"tinyqueue":2}]},{},[3])(3)
});
